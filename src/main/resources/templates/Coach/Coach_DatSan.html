<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="master/head::head"></head>
<body>
<!-- Sidebar -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:replace="master/master_coach/menu::menu"></div>
        <div class="layout-page">
            <div th:replace="master/navbar::navbar"></div>
            <div class="content-wrapper">
                <!-- Content -->
                <div class="container-xxl flex-grow-1 container-p-y">
                        <!-- Nội dung các trang con thay thế ở đây -->
                        <div class="container py-5">
                            <h1 class="text-center text-black fw-bold mb-4">ĐẶT SÂN PICKELBALL</h1>

                            <!-- Thông báo (nếu có) -->
                            <div th:if="${message}" class="alert alert-success alert-dismissible fade show" role="alert">
                                <span th:text="${message}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>

                            <!-- Form đặt sân -->
<!--                            <div class="container my-5">-->
<!--                                <div class="card">-->
<!--                                    <div class="card-header text-center">-->
<!--                                        <h5>Đặt sân <span th:text="${san.courtName}">Tên sân</span></h5>-->
<!--                                    </div>-->
<!--                                    <div class="card-body">-->
<!--                                        <form th:action="@{'/datsan/' + ${san.courtId}}" method="post">-->
<!--                                            <input type="hidden" name="courtId" th:value="${san.courtId}" />-->
<!--                                            <input type="hidden" th:id="'rentalPrice_' + ${san.courtId}" th:value="${san.rentalPrice}" />-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Họ và tên</label>-->
<!--                                                <input type="text" name="fullName" class="form-control" required />-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Số điện thoại</label>-->
<!--                                                <input type="text" name="phoneNumber" class="form-control" required />-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Ngày đặt</label>-->
<!--                                                <input type="date" name="bookingDate" class="form-control" required />-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Giờ bắt đầu</label>-->
<!--                                                <input type="time" name="startTime" class="form-control"-->
<!--                                                       th:attr="onchange=|calculateTotalPrice(${san.courtId})|" required />-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Giờ kết thúc</label>-->
<!--                                                <input type="time" name="endTime" class="form-control"-->
<!--                                                       th:attr="onchange=|calculateTotalPrice(${san.courtId})|" required />-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Giá thuê sân</label>-->
<!--                                                <p th:id="'formattedPrice_' + ${san.courtId}" th:text="${san.rentalPrice}">0</p>-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Tổng tiền</label>-->
<!--                                                <p th:id="'totalPrice_' + ${san.courtId}" th:text="'0 VND'"></p>-->
<!--                                            </div>-->

<!--                                            <div class="mb-3">-->
<!--                                                <label class="form-label">Ghi chú</label>-->
<!--                                                <textarea name="note" class="form-control" rows="2"></textarea>-->
<!--                                            </div>-->

<!--                                            <input type="hidden" name="totalPrice" th:id="'hiddenTotalPrice_' + ${san.courtId}" />-->

<!--                                            <div class="text-end">-->
<!--                                                <button type="submit" class="btn btn-primary">Đặt Sân</button>-->
<!--                                            </div>-->
<!--                                        </form>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->


                            <!-- Danh sách sân đã đặt -->
                            <div class="card shadow-lg p-4">
                                <h2 class="text-center text-black mb-3">Danh Sách Sân Đã Đặt</h2>
                                <table class="table table-striped text-center">
                                    <thead class="table-primary">
                                    <tr>
                                        <th>ID</th>
                                        <th>Tên Sân</th>
                                        <th>Ngày</th>
                                        <th>Giờ</th>
                                        <th>Hành Động</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="booking : ${bookings}">

                                        <td th:text="${booking.id}"></td>

                                        <td th:text="${booking.court.courtName}"></td>

                                        <td th:text="${booking.date}"></td>

                                        <td th:text="${booking.startTime}"></td>
                                        <td>
                                            <button class="btn btn-primary btn-sm">Sửa</button>
                                            <form th:action="@{/coach/deleteBooking/{id}(id=${booking.id})}" method="post" style="display:inline;">
                                                <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
                                            </form>
                                        </td>
                                    </tr>
                                    <tr th:if="${#lists.isEmpty(bookings)}">
                                        <td colspan="5">Chưa có sân nào được đặt.</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                        </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function calculateTotalPrice(courtId) {
        const rentalPrice = document.getElementById('rentalPrice_' + courtId).value;
        const startTime = document.getElementById('startTime_' + courtId).value;
        const endTime = document.getElementById('endTime_' + courtId).value;

        if (startTime && endTime) {
            const start = new Date("1970-01-01T" + startTime + "Z");
            const end = new Date("1970-01-01T" + endTime + "Z");
            const duration = (end - start) / (1000 * 60 * 60);  // tính giờ
            const totalPrice = duration * rentalPrice;
            document.getElementById('totalPrice_' + courtId).innerText = totalPrice + ' VND';
            document.getElementById('hiddenTotalPrice_' + courtId).value = totalPrice;
        }
    }
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>