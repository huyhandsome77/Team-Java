<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="master/head::head"></head>
<body>
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:replace="master/master_player/menu::menu"></div>
        <div class="layout-page">
            <div th:replace="master/master_player/navbar::navbar"></div>
            <div class="content-wrapper">
                <!-- Content -->

                <div class="container-xxl flex-grow-1 container-p-y">
                    <th:block th:fragment="content">
                        <!--Nội dung các trang con thay thế ở đây-->
                        <!DOCTYPE html>
                        <html lang="vi">
                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
                            <title>Thời Tiết</title>
                            <style>
                                body {
                                    background: #f0f8ff;
                                    font-family: 'Arial', sans-serif;
                                }

                                .weather-card {
                                    border-radius: 15px;
                                    padding: 30px;
                                    background: #fff;
                                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                                    text-align: center;
                                    max-width: 600px;
                                    margin: 50px auto;
                                }

                                .temp {
                                    font-size: 70px;
                                    font-weight: bold;
                                    color: #ff5733;
                                }

                                .weather-description {
                                    font-size: 18px;
                                    color: #777;
                                    margin-bottom: 20px;
                                }

                                .day {
                                    margin-top: 20px;
                                    display: flex;
                                    justify-content: space-between;
                                    flex-wrap: wrap;
                                }

                                .day .list-group-item {
                                    background: #f9f9f9;
                                    border: none;
                                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                                    margin: 10px 0;
                                    flex: 1;
                                    text-align: center;
                                }

                                .day .list-group-item img {
                                    width: 30px;
                                    margin-bottom: 10px;
                                }

                                .day .list-group-item strong {
                                    font-size: 18px;
                                    color: #333;
                                }

                                .day .list-group-item p {
                                    font-size: 14px;
                                    color: #555;
                                }

                                @media (max-width: 768px) {
                                    .day .list-group-item {
                                        flex: 0 0 48%;
                                        margin: 10px 1%;
                                    }
                                }

                                @media (max-width: 480px) {
                                    .day .list-group-item {
                                        flex: 0 0 100%;
                                        margin: 10px 0;
                                    }
                                }

                                .ai-prediction {
                                    margin-top: 20px;
                                    padding: 15px;
                                    background: #f9f9f9;
                                    border-radius: 10px;
                                    text-align: left;
                                }
                            </style>
                        </head>
                        <body>
                        <div class="container">
                            <div class="weather-card">
                                <h2 class="mb-4">Dự Báo Thời Tiết</h2>
                                <div class="mb-4">
                                    <input type="text" id="cityInput" class="form-control d-inline-block w-75" placeholder="Nhập tên thành phố">
                                    <button onclick="getWeather()" class="btn btn-primary ms-2">Tìm</button>
                                </div>
                                <p class="temp" id="currentTemp">28 °C</p>
                                <p class="weather-description" id="currentDescription">Nắng nhẹ, trời quang đãng</p>
                                <p id="currentDetails"><strong>Khả năng mưa:</strong> 0% | <strong>Độ ẩm:</strong> 82% | <strong>Gió:</strong> 5 km/h</p>

                                <div class="day" id="forecastDays"></div>

                                <div class="ai-prediction" id="aiPrediction">
                                    <h4>Dự đoán AI</h4>
                                    <p><strong>Xu hướng nhiệt độ:</strong> Đang tải...</p>
                                    <p><strong>Nhiệt độ dự đoán ngày mai:</strong> Đang tải...</p>
                                </div>
                            </div>
                        </div>

                        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
                        <script>
                            async function getWeather() {
                                const city = document.getElementById('cityInput').value;
                                if (!city) {
                                    alert('Vui lòng nhập tên thành phố');
                                    return;
                                }

                                try {
                                    const response = await fetch(`http://localhost:8080/api/weather/forecast?city=${city}`);
                                    const data = await response.json();
                                    updateCurrentWeather(data.forecast[0]);
                                    updateForecast(data.forecast.slice(1));
                                    updateAIPrediction(data.aiPrediction);
                                } catch (error) {
                                    console.error('Lỗi:', error);
                                    alert('Không thể lấy dữ liệu thời tiết');
                                }
                            }

                            function updateCurrentWeather(today) {
                                document.getElementById('currentTemp').innerText = `${Math.round(today.temperature)} °C`;
                                document.getElementById('currentDescription').innerText = today.description;
                                document.getElementById('currentDetails').innerHTML = `
                <strong>Khả năng mưa:</strong> ${today.precipitation || 0}% |
                <strong>Độ ẩm:</strong> ${today.humidity}% |
                <strong>Gió:</strong> ${today.windSpeed || 5} km/h
            `;
                            }

                            function updateForecast(forecast) {
                                const daysDiv = document.getElementById('forecastDays');
                                daysDiv.innerHTML = '';
                                const daysOfWeek = ['Chủ Nhật', 'Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7'];

                                forecast.slice(0, 5).forEach((day, index) => {
                                    const date = new Date(day.date);
                                    const dayName = daysOfWeek[date.getDay()];
                                    const icon = getWeatherIcon(day.description);
                                    const dayDiv = document.createElement('div');
                                    dayDiv.className = 'list-group-item';
                                    dayDiv.innerHTML = `
                    <strong>${dayName}</strong>
                    <img src="${icon}" alt="${day.description}">
                    <p>${Math.round(day.temperature)} °C<br>${Math.round(day.temperature - 2)} °C</p>
                `;
                                    daysDiv.appendChild(dayDiv);
                                });
                            }

                            function getWeatherIcon(description) {
                                if (description.includes('mưa')) return 'rain-icon.png';
                                if (description.includes('mây')) return 'cloud-icon.png';
                                if (description.includes('nắng')) return 'sun-icon.png';
                                return 'sun-cloud-icon.png';
                            }

                            function updateAIPrediction(prediction) {
                                document.getElementById('aiPrediction').innerHTML = `
                <h4>Dự đoán AI</h4>
                <p><strong>Xu hướng nhiệt độ:</strong> ${prediction.trend}</p>
                <p><strong>Nhiệt độ dự đoán ngày mai:</strong> ${Math.round(prediction.predictedTemperature)} °C</p>
            `;
                            }

                            <form action="/player/du-bao" method="get">
                                <div className="mb-3">
                                    <label htmlFor="city" className="form-label">Nhập thành phố</label>
                                    <input type="text" className="form-control" id="city" name="city"
                                           placeholder="Ví dụ: Ho Chi Minh"/>
                                </div>
                                <button type="submit" className="btn btn-primary">Xem Dự Báo</button>
                            </form>

                        </script>
                        </body>
                        </html>

                    </th:block>
                </div>
                <!-- / Content -->

                <!-- Footer -->
                <div th:replace="master/master_player/footer::footer"></div>
                <!-- / Footer -->
            </div>
        </div>
    </div>
</div>
<script th:replace="master/hoaroi::hoaroi"></script>
</body>
</html>